<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0d2818">
<title>Masters Augusta 2025 ¬∑ GDF</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&family=EB+Garamond:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --green-deep: #0d2818;
  --green-dark: #1a3d28;
  --green-mid: #2a5a3a;
  --green-light: #3d7a50;
  --gold: #c9a84c;
  --gold-light: #e8c96a;
  --gold-pale: #f0d98a;
  --cream: #f5f0e8;
  --cream-dark: #e8e0d0;
  --text: #f5f0e8;
  --text-muted: #a8c4a8;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'EB Garamond', Georgia, serif;
  background: var(--green-deep);
  color: var(--text);
  min-height: 100vh;
  background-image:
    radial-gradient(ellipse at 20% 50%, rgba(42,90,58,0.15) 0%, transparent 60%),
    radial-gradient(ellipse at 80% 20%, rgba(201,168,76,0.05) 0%, transparent 50%);
}
.screen { display: none; min-height: 100vh; flex-direction: column; opacity: 0; transition: opacity 0.4s; }
.screen.active { display: flex; }
.screen.visible { opacity: 1; }
.header {
  background: linear-gradient(180deg, #0a1f12 0%, var(--green-dark) 100%);
  padding: 24px 20px 20px;
  text-align: center;
  border-bottom: 1px solid rgba(201,168,76,0.3);
  position: relative;
  overflow: hidden;
}
.header::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg,transparent,var(--gold),transparent); }
.header::after { content:''; position:absolute; bottom:0; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,rgba(201,168,76,0.5),transparent); }
.logo-container { margin-bottom: 12px; }
.logo-img { width:60px; height:60px; object-fit:contain; filter:drop-shadow(0 2px 8px rgba(201,168,76,0.4)); }
.header h1 { font-family:'Cormorant Garamond',serif; font-size:26px; font-weight:600; color:var(--gold); letter-spacing:3px; text-transform:uppercase; }
.header-sub { font-family:'Cormorant Garamond',serif; font-size:13px; color:var(--text-muted); letter-spacing:2px; margin-top:4px; font-style:italic; }
.header-divider { width:60px; height:1px; background:linear-gradient(90deg,transparent,var(--gold),transparent); margin:10px auto 0; }
.content { flex:1; padding:24px 20px; max-width:480px; margin:0 auto; width:100%; }
.btn { display:block; width:100%; padding:14px 20px; border:none; border-radius:2px; font-family:'Cormorant Garamond',serif; font-size:16px; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; cursor:pointer; transition:all 0.3s; position:relative; overflow:hidden; }
.btn::after { content:''; position:absolute; top:50%; left:50%; width:0; height:0; background:rgba(255,255,255,0.1); border-radius:50%; transform:translate(-50%,-50%); transition:width 0.4s,height 0.4s; }
.btn:active::after { width:200px; height:200px; }
.btn-gold { background:linear-gradient(135deg,var(--gold),var(--gold-light)); color:var(--green-deep); }
.btn-gold:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(201,168,76,0.35); }
.btn-outline { background:transparent; border:1px solid rgba(201,168,76,0.5); color:var(--gold); }
.btn-outline:hover { border-color:var(--gold); background:rgba(201,168,76,0.05); }
.btn-ghost { background:transparent; border:1px solid rgba(255,255,255,0.1); color:var(--text-muted); font-size:13px; }
.btn-danger { background:rgba(139,32,32,0.8); border:1px solid rgba(220,80,80,0.3); color:#f0a0a0; }
.btn-success { background:rgba(26,74,42,0.8); border:1px solid rgba(79,200,112,0.3); color:#80e0a0; }
.input-group { margin-bottom: 16px; }
.input-label { display:block; font-family:'Cormorant Garamond',serif; font-size:12px; letter-spacing:2px; text-transform:uppercase; color:var(--text-muted); margin-bottom:8px; }
input[type=text], input[type=password] { width:100%; padding:14px 16px; border:1px solid rgba(201,168,76,0.2); border-radius:2px; background:rgba(26,61,40,0.5); color:var(--text); font-family:'EB Garamond',serif; font-size:16px; outline:none; transition:all 0.3s; backdrop-filter:blur(4px); }
input[type=text]:focus, input[type=password]:focus { border-color:rgba(201,168,76,0.6); background:rgba(26,61,40,0.7); box-shadow:0 0 0 3px rgba(201,168,76,0.08); }
input::placeholder { color:rgba(168,196,168,0.4); }
.card { background:rgba(26,61,40,0.4); border:1px solid rgba(201,168,76,0.15); border-radius:2px; padding:20px; margin-bottom:16px; backdrop-filter:blur(4px); position:relative; }
.card::before { content:''; position:absolute; top:0; left:20px; right:20px; height:1px; background:linear-gradient(90deg,transparent,rgba(201,168,76,0.3),transparent); }
.card-title { font-family:'Cormorant Garamond',serif; font-size:12px; letter-spacing:2px; text-transform:uppercase; color:var(--gold); margin-bottom:14px; }
.chapeau-header { display:flex; align-items:center; gap:12px; margin-bottom:16px; }
.chapeau-num { width:36px; height:36px; border:1px solid var(--gold); border-radius:50%; display:flex; align-items:center; justify-content:center; font-family:'Cormorant Garamond',serif; font-size:18px; font-weight:600; color:var(--gold); flex-shrink:0; }
.chapeau-info h3 { font-family:'Cormorant Garamond',serif; font-size:18px; font-weight:600; color:var(--text); }
.chapeau-info p { font-size:13px; color:var(--text-muted); font-style:italic; }
.joueurs-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
.joueur-btn { padding:10px 8px; border:1px solid rgba(201,168,76,0.15); border-radius:2px; background:rgba(13,40,24,0.6); color:var(--cream-dark); font-family:'EB Garamond',serif; font-size:13px; cursor:pointer; transition:all 0.2s; text-align:center; line-height:1.3; }
.joueur-btn:hover { border-color:rgba(201,168,76,0.4); background:rgba(26,61,40,0.8); }
.joueur-btn.selected { background:linear-gradient(135deg,rgba(201,168,76,0.25),rgba(201,168,76,0.15)); border-color:var(--gold); color:var(--gold-pale); font-weight:500; }
.joueur-btn.disabled { opacity:0.35; cursor:not-allowed; }
.step-indicator { display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:24px; }
.step-dot { width:6px; height:6px; border-radius:50%; background:rgba(201,168,76,0.2); transition:all 0.3s; }
.step-dot.active { background:var(--gold); transform:scale(1.4); }
.step-dot.done { background:rgba(201,168,76,0.6); }
.step-line { width:20px; height:1px; background:rgba(201,168,76,0.2); }
.rank-item { display:flex; align-items:center; gap:14px; padding:14px 16px; background:rgba(26,61,40,0.3); border:1px solid rgba(201,168,76,0.1); border-radius:2px; margin-bottom:6px; cursor:pointer; transition:all 0.2s; }
.rank-item:hover { background:rgba(26,61,40,0.5); border-color:rgba(201,168,76,0.25); }
.rank-num { font-family:'Cormorant Garamond',serif; font-size:20px; font-weight:600; color:var(--text-muted); width:28px; text-align:center; flex-shrink:0; }
.rank-num.gold { color:#FFD700; }
.rank-num.silver { color:#C0C0C0; }
.rank-num.bronze { color:#CD7F32; }
.rank-info { flex:1; }
.rank-name { font-family:'Cormorant Garamond',serif; font-size:17px; font-weight:600; }
.rank-joueurs { font-size:12px; color:var(--text-muted); margin-top:2px; font-style:italic; }
.rank-score { font-family:'Cormorant Garamond',serif; font-size:22px; font-weight:700; flex-shrink:0; }
.neg { color:#5dd880; } .pos { color:#e07070; } .even { color:var(--cream); }
.participant-detail { background:rgba(13,40,24,0.5); border:1px solid rgba(201,168,76,0.1); border-top:none; border-radius:0 0 2px 2px; padding:12px; margin-top:-6px; margin-bottom:6px; display:none; }
.participant-detail.open { display:block; }
.detail-row { display:flex; justify-content:space-between; align-items:center; padding:7px 0; border-bottom:1px solid rgba(201,168,76,0.06); font-size:13px; }
.detail-row:last-child { border-bottom:none; }
.best4-name { color:var(--gold-pale); }
.best4-star { color:var(--gold); margin-right:4px; font-size:10px; }
.tabs { display:flex; border-bottom:1px solid rgba(201,168,76,0.2); margin-bottom:20px; gap:0; }
.tab { flex:1; padding:10px 4px; text-align:center; font-family:'Cormorant Garamond',serif; font-size:13px; letter-spacing:1px; text-transform:uppercase; color:var(--text-muted); cursor:pointer; transition:all 0.2s; border-bottom:2px solid transparent; margin-bottom:-1px; }
.tab.active { color:var(--gold); border-bottom-color:var(--gold); }
.score-item { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid rgba(201,168,76,0.06); cursor:pointer; transition:all 0.2s; }
.score-item:hover { padding-left:4px; }
.score-item:last-child { border-bottom:none; }
.msg { padding:12px 16px; border-radius:2px; margin-bottom:14px; font-size:14px; font-style:italic; text-align:center; }
.msg.success { background:rgba(26,74,42,0.5); border:1px solid rgba(79,200,112,0.3); color:#80e0a0; }
.msg.error { background:rgba(74,26,26,0.5); border:1px solid rgba(220,80,80,0.3); color:#e09090; }
.msg.info { background:rgba(26,42,74,0.5); border:1px solid rgba(74,144,200,0.3); color:#90b8e0; }
.live-badge { display:inline-block; background:rgba(220,60,60,0.8); color:white; padding:2px 8px; border-radius:1px; font-family:'Cormorant Garamond',serif; font-size:10px; letter-spacing:2px; text-transform:uppercase; margin-left:8px; animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.6} }
.refresh-info { font-size:11px; font-style:italic; color:var(--text-muted); text-align:center; margin-bottom:14px; letter-spacing:0.5px; }
.ornement { text-align:center; color:var(--gold); font-size:18px; opacity:0.4; margin:12px 0; letter-spacing:6px; }
.divider { height:1px; background:linear-gradient(90deg,transparent,rgba(201,168,76,0.3),transparent); margin:16px 0; }
.edit-banner { background:rgba(26,42,74,0.4); border:1px solid rgba(74,144,200,0.3); border-radius:2px; padding:10px 14px; margin-bottom:16px; display:flex; justify-content:space-between; align-items:center; font-size:13px; font-style:italic; color:#90b8e0; }
.player-modal { position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:1000; display:flex; align-items:flex-end; justify-content:center; animation:fadeIn 0.25s; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
.player-sheet { background:linear-gradient(180deg,#1a3d28 0%,#0d2818 100%); border-top:1px solid rgba(201,168,76,0.3); border-radius:12px 12px 0 0; width:100%; max-width:480px; padding:28px 24px; max-height:85vh; overflow-y:auto; animation:slideUp 0.35s cubic-bezier(0.16,1,0.3,1); position:relative; }
.player-sheet::before { content:''; position:absolute; top:0; left:60px; right:60px; height:2px; background:linear-gradient(90deg,transparent,var(--gold),transparent); }
@keyframes slideUp { from{transform:translateY(100%)} to{transform:translateY(0)} }
.player-header { display:flex; gap:18px; align-items:center; margin-bottom:22px; }
.player-photo { width:80px; height:80px; border-radius:50%; object-fit:cover; border:2px solid rgba(201,168,76,0.5); flex-shrink:0; }
.player-photo-placeholder { width:80px; height:80px; border-radius:50%; border:2px solid rgba(201,168,76,0.3); background:rgba(26,61,40,0.5); display:flex; align-items:center; justify-content:center; font-size:30px; flex-shrink:0; }
.player-name-h { font-family:'Cormorant Garamond',serif; font-size:22px; font-weight:600; color:var(--gold); }
.player-name-sub { font-size:13px; color:var(--text-muted); margin-top:3px; font-style:italic; }
.player-stats-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:18px; }
.pstat { background:rgba(13,40,24,0.6); border:1px solid rgba(201,168,76,0.12); border-radius:2px; padding:12px; text-align:center; }
.pstat-val { font-family:'Cormorant Garamond',serif; font-size:22px; font-weight:600; color:var(--gold); }
.pstat-lbl { font-size:11px; letter-spacing:1px; text-transform:uppercase; color:var(--text-muted); margin-top:2px; }
.player-bio { font-size:14px; line-height:1.8; color:var(--cream-dark); margin-bottom:18px; font-style:italic; }
.palmares-item { display:flex; align-items:center; gap:10px; padding:8px 0; border-bottom:1px solid rgba(201,168,76,0.08); font-size:13px; }
.palmares-item:last-child { border-bottom:none; }
.player-close { position:absolute; top:18px; right:20px; background:none; border:none; color:var(--text-muted); font-size:22px; cursor:pointer; transition:color 0.2s; }
.player-close:hover { color:var(--gold); }
.news-section-title { font-family:'Cormorant Garamond',serif; font-size:12px; letter-spacing:2.5px; text-transform:uppercase; color:var(--text-muted); margin:20px 0 10px; padding-bottom:6px; border-bottom:1px solid rgba(201,168,76,0.15); }
.news-card { background:rgba(26,61,40,0.3); border:1px solid rgba(201,168,76,0.1); border-radius:2px; padding:16px; margin-bottom:10px; transition:all 0.2s; }
.news-card:hover { background:rgba(26,61,40,0.5); }
.news-tag { display:inline-block; padding:2px 8px; border-radius:1px; font-size:10px; letter-spacing:1px; text-transform:uppercase; margin-bottom:8px; margin-right:4px; }
.news-tag.masters { background:rgba(201,168,76,0.15); color:var(--gold); border:1px solid rgba(201,168,76,0.3); }
.news-tag.pga { background:rgba(74,144,200,0.1); color:#90b8e0; border:1px solid rgba(74,144,200,0.2); }
.news-tag.liv { background:rgba(200,74,74,0.1); color:#e09090; border:1px solid rgba(200,74,74,0.2); }
.news-tag.rumeur { background:rgba(144,74,200,0.1); color:#c090e0; border:1px solid rgba(144,74,200,0.2); }
.news-tag.stats { background:rgba(74,200,112,0.1); color:#80e0a0; border:1px solid rgba(74,200,112,0.2); }
.news-card h4 { font-family:'Cormorant Garamond',serif; font-size:17px; font-weight:600; color:var(--cream); margin-bottom:8px; line-height:1.4; }
.news-card p { font-size:13px; line-height:1.7; color:var(--cream-dark); font-style:italic; }
.typing-dots span { display:inline-block; animation:blink 1.4s infinite; font-size:22px; color:var(--gold); }
.typing-dots span:nth-child(2) { animation-delay:.2s; }
.typing-dots span:nth-child(3) { animation-delay:.4s; }
@keyframes blink { 0%,80%,100%{opacity:0} 40%{opacity:1} }
.admin-code-row { display:flex; align-items:center; gap:8px; padding:10px 0; border-bottom:1px solid rgba(201,168,76,0.08); font-size:14px; }
.admin-code-row:last-child { border-bottom:none; }
.admin-code-row span { flex:1; }
.code-badge { font-family:monospace; font-size:13px; background:rgba(201,168,76,0.1); border:1px solid rgba(201,168,76,0.2); padding:3px 8px; border-radius:2px; color:var(--gold); }
.mt { margin-top:12px; }
.nav-back { background:none; border:none; color:var(--text-muted); font-family:'Cormorant Garamond',serif; font-size:14px; letter-spacing:1px; cursor:pointer; padding:0; margin-bottom:20px; display:flex; align-items:center; gap:6px; }
.nav-back:hover { color:var(--gold); }
.toggle-link { background:none; border:none; color:var(--gold); font-family:'Cormorant Garamond',serif; font-size:14px; font-style:italic; cursor:pointer; text-decoration:underline; text-underline-offset:3px; display:block; text-align:center; margin-top:12px; }
.toggle-link:hover { color:var(--gold-light); }
</style>
</head>
<body>

<!-- ACCUEIL -->
<div id="screen-accueil" class="screen">
  <div class="header">
    <div class="logo-container">
      <img src="https://egasser17.github.io/Augusta/logo.png" class="logo-img" alt="GDF" onerror="this.style.display='none'">
    </div>
    <h1>Masters Augusta</h1>
    <div class="header-sub">Golf de Fontainebleau ¬∑ 2025</div>
    <div class="header-divider"></div>
  </div>
  <div class="content" style="display:flex;flex-direction:column;justify-content:center;flex:1">
    <div style="text-align:center;margin-bottom:36px">
      <div style="font-family:'Cormorant Garamond',serif;font-size:42px;color:var(--gold);opacity:0.3;margin-bottom:8px">‚õ≥</div>
      <p style="font-family:'Cormorant Garamond',serif;font-size:16px;font-style:italic;color:var(--text-muted);line-height:1.6">S√©lectionnez vos joueurs par chapeau<br>et suivez le tournoi en temps r√©el</p>
    </div>
    <div id="msg-accueil"></div>

    <!-- CONNEXION -->
    <div id="form-connexion">
      <div class="input-group">
        <label class="input-label">Votre pseudo</label>
        <input type="text" id="nom-input" placeholder="Ex : Pilou" maxlength="30">
      </div>
      <div class="input-group">
        <label class="input-label">Code d'acc√®s</label>
        <input type="password" id="code-input" placeholder="Votre code personnel" maxlength="20">
      </div>
      <button class="btn btn-gold mt" onclick="handleAccueil()">Acc√©der ¬∑ Mes s√©lections</button>
      <button class="toggle-link" onclick="toggleForm()">Premi√®re visite ? Cr√©er un compte</button>
    </div>

    <!-- INSCRIPTION -->
    <div id="form-inscription" style="display:none">
      <div class="input-group">
        <label class="input-label">Pr√©nom</label>
        <input type="text" id="reg-prenom" placeholder="Ex : Pierre" maxlength="30">
      </div>
      <div class="input-group">
        <label class="input-label">Nom</label>
        <input type="text" id="reg-nom" placeholder="Ex : Dupont" maxlength="30">
      </div>
      <div class="input-group">
        <label class="input-label">Pseudo (affich√© dans le classement)</label>
        <input type="text" id="reg-pseudo" placeholder="Ex : Pilou" maxlength="30">
      </div>
      <div class="input-group">
        <label class="input-label">Code d'acc√®s personnel</label>
        <input type="text" id="reg-code" placeholder="Ex : Pierre2025" maxlength="20">
      </div>
      <button class="btn btn-gold mt" onclick="handleInscription()">Cr√©er mon compte</button>
      <button class="toggle-link" onclick="toggleForm()">D√©j√† inscrit ? Se connecter</button>
    </div>

    <div class="divider"></div>
    <button class="btn btn-outline" onclick="goClassement()">Consulter le classement</button>
    <button class="btn btn-ghost mt" onclick="goAdmin()" style="margin-top:8px;font-size:12px;letter-spacing:1px">Administration</button>
  </div>
</div>

<!-- SELECTION -->
<div id="screen-selection" class="screen">
  <div class="header">
    <div class="logo-container"><img src="https://egasser17.github.io/Augusta/logo.png" class="logo-img" alt="GDF" onerror="this.style.display='none'"></div>
    <h1>Mes S√©lections</h1>
    <div class="header-sub" id="selection-user-name"></div>
    <div class="header-divider"></div>
  </div>
  <div class="content">
    <div id="edit-banner" style="display:none" class="edit-banner">
      <span>‚ú¶ Mode √©dition</span>
      <button class="btn btn-ghost" style="width:auto;padding:6px 12px;font-size:11px" onclick="cancelEdit()">Annuler</button>
    </div>
    <div class="step-indicator" id="step-dots"></div>
    <div id="selection-content"></div>
    <div style="display:flex;gap:10px;margin-top:20px">
      <button class="btn btn-outline" id="btn-prev" onclick="prevChapeau()" style="flex:0 0 110px">‚Üê Retour</button>
      <button class="btn btn-gold" id="btn-next" onclick="nextChapeau()">Suivant ‚Üí</button>
    </div>
  </div>
</div>

<!-- CLASSEMENT -->
<div id="screen-classement" class="screen">
  <div class="header">
    <div class="logo-container"><img src="https://egasser17.github.io/Augusta/logo.png" class="logo-img" alt="GDF" onerror="this.style.display='none'"></div>
    <h1>Classement <span class="live-badge">Live</span></h1>
    <div class="header-sub">Masters Augusta 2025</div>
    <div class="header-divider"></div>
  </div>
  <div class="content">
    <div class="tabs">
      <div class="tab active" onclick="switchTab('classement')">Classement</div>
      <div class="tab" onclick="switchTab('scores')">Joueurs</div>
      <div class="tab" onclick="switchTab('news')">Actualit√©s</div>
    </div>
    <div id="refresh-info" class="refresh-info"></div>
    <div id="tab-classement"></div>
    <div id="tab-scores" style="display:none"></div>
    <div id="tab-news" style="display:none"></div>
    <div class="divider"></div>
    <button class="btn btn-outline" onclick="showScreen('screen-accueil')" style="font-size:13px">‚Üê Retour √† l'accueil</button>
  </div>
</div>

<!-- CONFIRMATION -->
<div id="screen-confirm" class="screen">
  <div class="header">
    <div class="logo-container"><img src="https://egasser17.github.io/Augusta/logo.png" class="logo-img" alt="GDF" onerror="this.style.display='none'"></div>
    <h1 id="confirm-title">S√©lections enregistr√©es</h1>
    <div class="header-sub" id="confirm-subtitle">Bonne chance pour les Masters !</div>
    <div class="header-divider"></div>
  </div>
  <div class="content" style="display:flex;flex-direction:column;justify-content:center;flex:1">
    <div class="ornement">‚ú¶ ‚ú¶ ‚ú¶</div>
    <div id="confirm-recap"></div>
    <div class="divider"></div>
    <button class="btn btn-gold" onclick="goClassement()">Voir le classement</button>
  </div>
</div>

<!-- ADMIN -->
<div id="screen-admin" class="screen">
  <div class="header">
    <div class="logo-container"><img src="https://egasser17.github.io/Augusta/logo.png" class="logo-img" alt="GDF" onerror="this.style.display='none'"></div>
    <h1>Administration</h1>
    <div class="header-sub">Golf de Fontainebleau</div>
    <div class="header-divider"></div>
  </div>
  <div class="content">
    <button class="nav-back" onclick="showScreen('screen-accueil')">‚Üê Retour</button>
    <div id="admin-auth" class="card">
      <div class="card-title">Acc√®s administrateur</div>
      <div class="input-group">
        <input type="password" id="admin-pwd" placeholder="Mot de passe">
      </div>
      <button class="btn btn-gold" onclick="checkAdmin()">Acc√©der</button>
    </div>
    <div id="admin-panel" style="display:none">
      <div class="card">
        <div class="card-title">Statut du tournoi</div>
        <div style="display:flex;gap:10px;margin-bottom:10px">
          <button class="btn btn-success" onclick="setTournoi('OUI')" style="flex:1">Ouvert</button>
          <button class="btn btn-danger" onclick="setTournoi('NON')" style="flex:1">Ferm√©</button>
        </div>
        <p id="statut-tournoi" style="font-size:13px;font-style:italic;color:var(--text-muted)"></p>
      </div>
      <div class="card">
        <div class="card-title">Participants inscrits</div>
        <p style="font-size:13px;font-style:italic;color:var(--text-muted);margin-bottom:14px">Nom r√©el, pseudo et code de chaque participant.</p>
        <div id="admin-codes-list"></div>
        <div class="divider"></div>
        <div class="card-title" style="margin-bottom:10px">Ajouter manuellement</div>
        <div class="input-group">
          <label class="input-label">Pr√©nom r√©el</label>
          <input type="text" id="new-prenom" placeholder="Pierre">
        </div>
        <div class="input-group">
          <label class="input-label">Nom r√©el</label>
          <input type="text" id="new-nom" placeholder="Dupont">
        </div>
        <div class="input-group">
          <label class="input-label">Pseudo</label>
          <input type="text" id="new-participant-nom" placeholder="Pilou">
        </div>
        <div class="input-group">
          <label class="input-label">Code d'acc√®s</label>
          <input type="text" id="new-participant-code" placeholder="Pierre2025">
        </div>
        <button class="btn btn-gold" onclick="addParticipantCode()">Ajouter ce participant</button>
        <div id="admin-codes-msg" style="margin-top:10px"></div>
      </div>
      <div class="card">
        <div class="card-title">Synchronisation ESPN</div>
        <p style="font-size:13px;font-style:italic;color:var(--text-muted);margin-bottom:12px">Scores mis √† jour automatiquement toutes les 5 minutes.</p>
        <button class="btn btn-outline" onclick="syncESPN()">Synchroniser maintenant</button>
        <div id="sync-msg" style="margin-top:10px"></div>
      </div>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL='https://nhlyqglrawsvvfaymedc.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5obHlxZ2xyYXdzdnZmYXltZWRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3ODMwNjMsImV4cCI6MjA4NzM1OTA2M30.kaCGdzJ26kvgPP4EyCzU7v_7j2dJcU87yaZMtDuSHnw';
const ESPN_PROXY='https://espn-golf-proxy.edouard-gasser.workers.dev/';
const ADMIN_PWD='masters2025';
const REFRESH_INTERVAL=5*60*1000;

const JOUEURS={
  1:['Scottie Scheffler','Rory McIlroy','Jon Rahm','Tommy Fleetwood','Bryson DeChambeau','Tyrrell Hatton','Robert MacIntyre','Shane Lowry','Xander Schauffele','Collin Morikawa','Ludvig Aberg','Viktor Hovland','Joaquin Niemann','Justin Thomas','Brooks Koepka','Jordan Spieth','Justin Rose','Russell Henley','Matt Fitzpatrick','Patrick Cantlay'],
  2:['Sepp Straka','Cameron Young','Hideki Matsuyama','Adam Scott','Ryan Fox','Jason Day','J.J. Spaun','Ben Griffin','Patrick Reed','Corey Conners','Min Woo Lee','Aaron Rai','Brian Harman','Carlos Ortiz','Sam Burns','Thomas Detry','Cameron Smith','Tony Finau','Sungjae Im','Wyndham Clark'],
  3:['Rickie Fowler','Keegan Bradley','Si Woo Kim','Akshay Bhatia','Taylor Pendrith','Marc Leishman','Daniel Berger','Lucas Herbert','Harry Hall','Aldrich Potgieter','Tom Kim','Rasmus Hojgaard','Tom McKibbin','Dean Burmester','Nicolai Hojgaard','Sergio Garcia'],
  4:['Sahith Theegala','Thriston Lawrence','Harris English','Louis Oosthuizen','Byeong Hun An','Davis Thompson','Dustin Johnson','Maverick McNealy','Thorbjorn Olesen','Matt Wallace','Christiaan Bezuidenhout','Emiliano Grillo','Nick Taylor','Denny McCarthy','J.T. Poston','Tom Hoge','Chris Kirk','Martin Couvra','Nick Dunlap','Jason Kokrak','Matthieu Pavon','Stephan Jaeger','Phil Mickelson','Adrien Saddier']
};
const ALL_JOUEURS=Object.values(JOUEURS).flat();
const NB_CHAPEAUX=4;

let currentUser='',currentCode='',currentChapeau=1,isEditMode=false;
let selections={1:[],2:[],3:[],4:[]};
let espnScores={},refreshTimer=null,lastUpdated=null,newsLoaded=false;
let showingInscription=false;

// ---- SUPABASE ----
async function sbFetch(path,opts={}){
  const res=await fetch(SUPABASE_URL+'/rest/v1/'+path,{
    headers:{'apikey':SUPABASE_KEY,'Authorization':'Bearer '+SUPABASE_KEY,'Content-Type':'application/json','Prefer':opts.prefer||'return=representation',...opts.headers},
    ...opts
  });
  if(!res.ok){const e=await res.text();throw new Error(e);}
  if(res.status===204||res.headers.get('content-length')==='0') return null;
  const t=await res.text();return t?JSON.parse(t):null;
}

// ---- UTILS ----
function parseScore(s){if(!s||s==='E') return 0;return parseInt(s)||0;}
function normalizeName(n){return n.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z\s]/g,'').trim();}
function getScore(nom){const k=normalizeName(nom);return espnScores[k]!==undefined?espnScores[k]:null;}
function fmtScore(s){if(s===null||s===undefined) return 'N/A';if(s===0) return 'E';return(s>0?'+':'')+s;}
function scoreClass(s){if(s===null) return '';return s<0?'neg':s>0?'pos':'even';}
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>{s.classList.remove('active','visible');});
  const el=document.getElementById(id);
  el.classList.add('active');
  setTimeout(()=>el.classList.add('visible'),10);
  window.scrollTo(0,0);
}
function showMsg(id,txt,type='info'){const el=document.getElementById(id);if(el) el.innerHTML=`<div class="msg ${type}">${txt}</div>`;}

// ---- TOGGLE FORM ----
function toggleForm(){
  showingInscription=!showingInscription;
  document.getElementById('form-connexion').style.display=showingInscription?'none':'block';
  document.getElementById('form-inscription').style.display=showingInscription?'block':'none';
  document.getElementById('msg-accueil').innerHTML='';
}

// ---- ESPN ----
async function fetchESPNScores(){
  try{
    const res=await fetch(ESPN_PROXY);
    const data=await res.json();
    const map={};
    (data.scores||[]).forEach(j=>{map[normalizeName(j.nom)]=parseScore(j.score);});
    espnScores=map;lastUpdated=new Date();return true;
  }catch(e){console.error(e);return false;}
}

// ---- INSCRIPTION ----
async function handleInscription(){
  const prenom=document.getElementById('reg-prenom').value.trim();
  const nom=document.getElementById('reg-nom').value.trim();
  const pseudo=document.getElementById('reg-pseudo').value.trim();
  const code=document.getElementById('reg-code').value.trim();
  if(!prenom||!nom||!pseudo||!code){showMsg('msg-accueil','Tous les champs sont requis.','error');return;}
  showMsg('msg-accueil','Cr√©ation du compte...','info');
  try{
    // V√©rifier que le pseudo n'existe pas d√©j√†
    const existing=await sbFetch(`codes_acces?nom=eq.${encodeURIComponent(pseudo)}&select=id`);
    if(existing&&existing.length>0){showMsg('msg-accueil','Ce pseudo est d√©j√† pris. Choisissez-en un autre.','error');return;}
    await sbFetch('codes_acces',{method:'POST',body:JSON.stringify({nom:pseudo,code,prenom_reel:prenom,nom_reel:nom}),prefer:'return=minimal'});
    showMsg('msg-accueil',`‚úì Compte cr√©√© ! Bienvenue ${pseudo}.`,'success');
    // Auto-connexion
    currentUser=pseudo;currentCode=code;
    const cfg=await sbFetch('config?cle=eq.tournoi_ouvert&select=valeur');
    const isOpen=!cfg||!cfg[0]||cfg[0].valeur==='OUI';
    if(!isOpen){showMsg('msg-accueil','Compte cr√©√© mais les s√©lections sont ferm√©es. Le tournoi a d√©but√© !','error');return;}
    selections={1:[],2:[],3:[],4:[]};currentChapeau=1;isEditMode=false;
    document.getElementById('selection-user-name').textContent=pseudo;
    document.getElementById('edit-banner').style.display='none';
    setTimeout(()=>{showScreen('screen-selection');renderChapeau();},800);
  }catch(e){showMsg('msg-accueil','Erreur lors de la cr√©ation. R√©essayez.','error');console.error(e);}
}

// ---- CONNEXION ----
async function handleAccueil(){
  const nom=document.getElementById('nom-input').value.trim();
  const code=document.getElementById('code-input').value.trim();
  if(!nom){showMsg('msg-accueil','Veuillez entrer votre pseudo.','error');return;}
  if(!code){showMsg('msg-accueil','Veuillez entrer votre code d\'acc√®s.','error');return;}
  showMsg('msg-accueil','V√©rification en cours...','info');
  try{
    const codeCheck=await sbFetch(`codes_acces?nom=eq.${encodeURIComponent(nom)}&code=eq.${encodeURIComponent(code)}&select=*`);
    if(!codeCheck||codeCheck.length===0){showMsg('msg-accueil','Pseudo ou code incorrect.','error');return;}
    const cfg=await sbFetch('config?cle=eq.tournoi_ouvert&select=valeur');
    const isOpen=!cfg||!cfg[0]||cfg[0].valeur==='OUI';
    const existing=await sbFetch(`participants?nom=eq.${encodeURIComponent(nom)}&select=*`);
    currentUser=nom;currentCode=code;
    if(existing&&existing.length>0){
      if(isOpen){loadExistingAndEdit(existing[0]);}
      else{showMsg('msg-accueil','Bienvenue '+nom+' ! Les s√©lections sont ferm√©es.','info');setTimeout(()=>goClassement(),1500);}
      return;
    }
    if(!isOpen){showMsg('msg-accueil','Les s√©lections sont ferm√©es. Le tournoi a d√©but√© !','error');return;}
    selections={1:[],2:[],3:[],4:[]};currentChapeau=1;isEditMode=false;
    document.getElementById('selection-user-name').textContent=nom;
    document.getElementById('edit-banner').style.display='none';
    showScreen('screen-selection');renderChapeau();
  }catch(e){showMsg('msg-accueil','Erreur de connexion. R√©essayez.','error');console.error(e);}
}

function loadExistingAndEdit(p){
  selections={1:[p.c1a,p.c1b].filter(Boolean),2:[p.c2a,p.c2b].filter(Boolean),3:[p.c3a,p.c3b].filter(Boolean),4:[p.c4a,p.c4b].filter(Boolean)};
  isEditMode=true;currentChapeau=1;
  document.getElementById('selection-user-name').textContent=currentUser;
  document.getElementById('edit-banner').style.display='flex';
  showScreen('screen-selection');renderChapeau();
}
function cancelEdit(){isEditMode=false;showScreen('screen-accueil');}

// ---- SELECTION ----
function renderChapeau(){
  let dotsHtml='';
  for(let i=1;i<=NB_CHAPEAUX;i++){
    if(i>1) dotsHtml+=`<div class="step-line"></div>`;
    const cls=i===currentChapeau?'active':(selections[i].length===2?'done':'');
    dotsHtml+=`<div class="step-dot ${cls}"></div>`;
  }
  document.getElementById('step-dots').innerHTML=dotsHtml;
  const joueurs=JOUEURS[currentChapeau],sel=selections[currentChapeau];
  let html=`<div class="card"><div class="chapeau-header"><div class="chapeau-num">${currentChapeau}</div><div class="chapeau-info"><h3>Chapeau ${currentChapeau}</h3><p>${sel.length}/2 joueurs s√©lectionn√©s</p></div></div><div class="joueurs-grid">`;
  joueurs.forEach(j=>{
    const isSel=sel.includes(j),isDisabled=!isSel&&sel.length>=2;
    html+=`<button class="joueur-btn ${isSel?'selected':''} ${isDisabled?'disabled':''}" onclick="toggleJoueur('${j.replace(/'/g,"\\'")}',${currentChapeau})">${j}</button>`;
  });
  html+=`</div></div>`;
  document.getElementById('selection-content').innerHTML=html;
  document.getElementById('btn-prev').style.display=currentChapeau===1?'none':'block';
  const allDone=Object.values(selections).every(s=>s.length===2);
  const btn=document.getElementById('btn-next');
  if(currentChapeau===NB_CHAPEAUX){btn.textContent=allDone?(isEditMode?'Sauvegarder les modifications':'Valider mes s√©lections'):'Valider ‚Üí';btn.className='btn '+(allDone?'btn-gold':'btn-outline');}
  else{btn.textContent='Suivant ‚Üí';btn.className='btn btn-gold';}
}
function toggleJoueur(nom,chapeau){
  const sel=selections[chapeau];
  if(sel.includes(nom)) selections[chapeau]=sel.filter(j=>j!==nom);
  else if(sel.length<2) selections[chapeau].push(nom);
  renderChapeau();
}
function nextChapeau(){
  if(selections[currentChapeau].length<2){alert('Veuillez s√©lectionner 2 joueurs dans le chapeau '+currentChapeau);return;}
  if(currentChapeau<NB_CHAPEAUX){currentChapeau++;renderChapeau();}
  else submitSelections();
}
function prevChapeau(){if(currentChapeau>1){currentChapeau--;renderChapeau();}}

async function submitSelections(){
  if(!Object.values(selections).every(s=>s.length===2)){alert('2 joueurs par chapeau requis');return;}
  const data={nom:currentUser,c1a:selections[1][0],c1b:selections[1][1],c2a:selections[2][0],c2b:selections[2][1],c3a:selections[3][0],c3b:selections[3][1],c4a:selections[4][0],c4b:selections[4][1]};
  try{
    if(isEditMode){
      await sbFetch(`participants?nom=eq.${encodeURIComponent(currentUser)}`,{method:'PATCH',body:JSON.stringify(data),prefer:'return=minimal'});
      document.getElementById('confirm-title').textContent='Modifications sauvegard√©es';
      document.getElementById('confirm-subtitle').textContent='Vos s√©lections ont √©t√© mises √† jour.';
    }else{
      await sbFetch('participants',{method:'POST',body:JSON.stringify(data),prefer:'return=minimal'});
      document.getElementById('confirm-title').textContent='S√©lections enregistr√©es';
      document.getElementById('confirm-subtitle').textContent='Bonne chance pour les Masters !';
    }
    let html='';
    for(let c=1;c<=NB_CHAPEAUX;c++){
      html+=`<div class="card" style="margin-bottom:8px"><div class="card-title">Chapeau ${c}</div><p style="font-size:15px;font-style:italic">‚õ≥ ${selections[c][0]}</p><p style="font-size:15px;font-style:italic;margin-top:4px">‚õ≥ ${selections[c][1]}</p></div>`;
    }
    document.getElementById('confirm-recap').innerHTML=html;
    showScreen('screen-confirm');
  }catch(e){alert('Erreur lors de la sauvegarde. R√©essayez.');console.error(e);}
}

// ---- CLASSEMENT ----
async function goClassement(){
  showScreen('screen-classement');switchTab('classement');newsLoaded=false;
  if(refreshTimer) clearInterval(refreshTimer);
  refreshTimer=setInterval(async()=>{await fetchESPNScores();await loadClassement();},REFRESH_INTERVAL);
  await loadClassement();
}
async function loadClassement(){
  document.getElementById('tab-classement').innerHTML='<div style="text-align:center;padding:40px;color:var(--text-muted);font-style:italic">Chargement...</div>';
  try{
    const [_,participants]=await Promise.all([fetchESPNScores(),sbFetch('participants?select=*&order=nom')]);
    if(lastUpdated) document.getElementById('refresh-info').textContent=`Scores ESPN mis √† jour √† ${lastUpdated.toLocaleTimeString('fr-FR')} ¬∑ Actualisation automatique`;
    const results=(participants||[]).map(p=>{
      const myJ=[p.c1a,p.c1b,p.c2a,p.c2b,p.c3a,p.c3b,p.c4a,p.c4b].filter(Boolean);
      const scores=myJ.map(j=>({nom:j,score:getScore(j)??0}));
      scores.sort((a,b)=>a.score-b.score);
      const best4=scores.slice(0,4);
      const total=best4.reduce((s,j)=>s+j.score,0);
      return{nom:p.nom,total,best4,allJoueurs:scores};
    });
    results.sort((a,b)=>a.total-b.total);
    let html='';
    results.forEach((r,i)=>{
      const nc=i===0?'gold':i===1?'silver':i===2?'bronze':'';
      const b4=r.best4.map(j=>j.nom.split(' ').pop()).join(', ');
      html+=`<div class="rank-item" onclick="toggleDetail('d${i}')">
        <div class="rank-num ${nc}">${i+1}</div>
        <div class="rank-info"><div class="rank-name">${r.nom}</div><div class="rank-joueurs">Best 4 : ${b4}</div></div>
        <div class="rank-score ${scoreClass(r.total)}">${fmtScore(r.total)}</div>
      </div>
      <div class="participant-detail" id="d${i}">
        ${r.allJoueurs.map((j,idx)=>`<div class="detail-row">
          <span class="${idx<4?'best4-name':''}"><span class="best4-star">${idx<4?'‚ú¶':''}</span>${j.nom}</span>
          <span class="${scoreClass(j.score)}" style="font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:600">${fmtScore(j.score)}</span>
        </div>`).join('')}
      </div>`;
    });
    if(!html) html='<div style="text-align:center;padding:40px;color:var(--text-muted);font-style:italic">Aucun participant pour l\'instant</div>';
    document.getElementById('tab-classement').innerHTML=html;
    const scoresTab=ALL_JOUEURS.map(n=>({nom:n,score:getScore(n)})).filter(j=>j.score!==null).sort((a,b)=>a.score-b.score);
    let shtml='<div class="card">';
    if(scoresTab.length) scoresTab.forEach(j=>{
      shtml+=`<div class="score-item" onclick="openPlayerCard('${j.nom.replace(/'/g,"\\'")}')">
        <span style="font-size:14px;font-style:italic">‚õ≥ ${j.nom}</span>
        <div style="display:flex;align-items:center;gap:10px">
          <span style="font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:600" class="${scoreClass(j.score)}">${fmtScore(j.score)}</span>
          <span style="color:var(--text-muted);font-size:14px">‚Ä∫</span>
        </div>
      </div>`;
    });
    else{
      shtml+='<div style="padding:16px 0;font-style:italic;color:var(--text-muted);font-size:14px;text-align:center">Les scores ne sont pas encore disponibles</div>';
      ALL_JOUEURS.forEach(n=>{
        shtml+=`<div class="score-item" onclick="openPlayerCard('${n.replace(/'/g,"\\'")}')"><span style="font-size:14px;font-style:italic">‚õ≥ ${n}</span><span style="color:var(--text-muted);font-size:14px">‚Ä∫</span></div>`;
      });
    }
    shtml+='</div>';
    document.getElementById('tab-scores').innerHTML=shtml;
  }catch(e){document.getElementById('tab-classement').innerHTML='<div class="msg error">Erreur de chargement</div>';console.error(e);}
}
function toggleDetail(id){document.getElementById(id).classList.toggle('open');}
function switchTab(tab){
  const tabs=['classement','scores','news'];
  document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active',tabs[i]===tab));
  tabs.forEach(t=>{const el=document.getElementById('tab-'+t);if(el) el.style.display=t===tab?'block':'none';});
  if(tab==='news'&&!newsLoaded) loadNews();
}

// ---- PLAYER DATA ----
const PLAYER_DATA={
  'Scottie Scheffler':{espn_id:'9478',nationalite:'üá∫üá∏ Am√©ricain',age:27,classement_mondial:1,palmares_majeurs:2,turned_pro:2018,meilleur_resultat_masters:'Vainqueur 2022, 2024',bio:"Num√©ro 1 mondial incontest√©, Scottie Scheffler a domin√© la saison 2024 de mani√®re √©crasante.",statistiques:{driving_distance:'318 yards',fairways:'57%',gir:'72%',putts_par_trou:'1.71'},palmares_liste:['Masters 2022, 2024','Players Championship 2024','M√©daille d\'Or JO 2024']},
  'Rory McIlroy':{espn_id:'3470',nationalite:'üáÆüá™ Irlandais',age:35,classement_mondial:3,palmares_majeurs:4,turned_pro:2007,meilleur_resultat_masters:'2√®me 2022',bio:"Le Masters reste le seul Major qui manque √† Rory McIlroy pour compl√©ter le Grand Chelem.",statistiques:{driving_distance:'320 yards',fairways:'54%',gir:'70%',putts_par_trou:'1.73'},palmares_liste:['US Open 2011','The Open 2014','PGA Championship 2012, 2014']},
  'Jon Rahm':{espn_id:'9780',nationalite:'üá™üá∏ Espagnol',age:30,classement_mondial:4,palmares_majeurs:2,turned_pro:2016,meilleur_resultat_masters:'Vainqueur 2023',bio:"Le g√©ant basque a remport√© Augusta en 2023 de fa√ßon magistrale.",statistiques:{driving_distance:'308 yards',fairways:'58%',gir:'71%',putts_par_trou:'1.74'},palmares_liste:['Masters 2023','US Open 2021']},
  'Xander Schauffele':{espn_id:'9003',nationalite:'üá∫üá∏ Am√©ricain',age:30,classement_mondial:2,palmares_majeurs:2,turned_pro:2015,meilleur_resultat_masters:'2√®me 2019',bio:"Longtemps le meilleur joueur sans Major, Schauffele a tout rafl√© en 2024.",statistiques:{driving_distance:'305 yards',fairways:'60%',gir:'72%',putts_par_trou:'1.72'},palmares_liste:['PGA Championship 2024','The Open 2024','M√©daille d\'Or JO 2020']},
  'Ludvig Aberg':{espn_id:'11813',nationalite:'üá∏üá™ Su√©dois',age:24,classement_mondial:6,palmares_majeurs:0,turned_pro:2023,meilleur_resultat_masters:'2√®me 2024',bio:"La sensation su√©doise. Pass√© professionnel en 2023, il a fr√¥l√© la victoire au Masters 2024.",statistiques:{driving_distance:'312 yards',fairways:'61%',gir:'71%',putts_par_trou:'1.74'},palmares_liste:['RSM Classic 2023','Hero World Challenge 2024']},
  'Hideki Matsuyama':{espn_id:'5860',nationalite:'üáØüáµ Japonais',age:32,classement_mondial:14,palmares_majeurs:1,turned_pro:2013,meilleur_resultat_masters:'Vainqueur 2021',bio:"Ic√¥ne du golf japonais, sa victoire au Masters 2021 a d√©clench√© une ferveur nationale.",statistiques:{driving_distance:'296 yards',fairways:'56%',gir:'69%',putts_par_trou:'1.76'},palmares_liste:['Masters 2021']},
  'Dustin Johnson':{espn_id:'3843',nationalite:'üá∫üá∏ Am√©ricain',age:40,classement_mondial:20,palmares_majeurs:2,turned_pro:2007,meilleur_resultat_masters:'Vainqueur 2020',bio:"Ancien num√©ro 1 mondial, vainqueur du Masters 2020 et de l'US Open 2016.",statistiques:{driving_distance:'314 yards',fairways:'56%',gir:'68%',putts_par_trou:'1.76'},palmares_liste:['Masters 2020','US Open 2016']},
  'Brooks Koepka':{espn_id:'5765',nationalite:'üá∫üá∏ Am√©ricain',age:34,classement_mondial:25,palmares_majeurs:5,turned_pro:2012,meilleur_resultat_masters:'2√®me 2019, 2023',bio:"Le sp√©cialiste des Majeurs par excellence. Avec 5 titres en Grand Chelem.",statistiques:{driving_distance:'313 yards',fairways:'55%',gir:'68%',putts_par_trou:'1.76'},palmares_liste:['US Open 2017, 2018','PGA Championship 2018, 2019']},
  'Phil Mickelson':{espn_id:'1003',nationalite:'üá∫üá∏ Am√©ricain',age:54,classement_mondial:150,palmares_majeurs:6,turned_pro:1992,meilleur_resultat_masters:'Vainqueur 2004, 2006, 2010',bio:"L√©gende vivante avec 6 Majeurs. Vainqueur du PGA Championship 2021 √† 50 ans.",statistiques:{driving_distance:'295 yards',fairways:'54%',gir:'65%',putts_par_trou:'1.77'},palmares_liste:['Masters 2004, 2006, 2010','PGA Championship 2005, 2021','The Open 2013']},
  'Sergio Garcia':{espn_id:'1120',nationalite:'üá™üá∏ Espagnol',age:45,classement_mondial:95,palmares_majeurs:1,turned_pro:1999,meilleur_resultat_masters:'Vainqueur 2017',bio:"L√©gende espagnole du golf avec plus de 35 ans de carri√®re.",statistiques:{driving_distance:'291 yards',fairways:'61%',gir:'66%',putts_par_trou:'1.76'},palmares_liste:['Masters 2017','Players Championship 2008']},
  'Matthieu Pavon':{espn_id:'11214',nationalite:'üá´üá∑ Fran√ßais',age:31,classement_mondial:45,palmares_majeurs:0,turned_pro:2015,meilleur_resultat_masters:'T28 2024',bio:"Premier Fran√ßais √† remporter un tournoi du PGA Tour depuis 1999.",statistiques:{driving_distance:'299 yards',fairways:'61%',gir:'67%',putts_par_trou:'1.76'},palmares_liste:['Farmers Insurance Open 2024']}
};

function openPlayerCard(nom){
  const modal=document.createElement('div');
  modal.className='player-modal';modal.id='player-modal';
  document.body.appendChild(modal);
  modal.addEventListener('click',e=>{if(e.target===modal) closePlayerCard();});
  const score=getScore(nom);
  const chapeau=Object.entries(JOUEURS).find(([c,js])=>js.includes(nom))?.[0]||'?';
  const info=PLAYER_DATA[nom]||null;
  if(info) info.photo_url=`https://a.espncdn.com/combiner/i?img=/i/headshots/golf/players/full/${info.espn_id}.png&w=200&h=146`;
  renderPlayerCard(info,nom,score,chapeau);
}
function renderPlayerCard(info,nom,score,chapeau){
  const modal=document.getElementById('player-modal');if(!modal) return;
  const sc=fmtScore(score),cls=scoreClass(score);
  if(!info){
    modal.innerHTML=`<div class="player-sheet" style="position:relative"><button class="player-close" onclick="closePlayerCard()">‚úï</button><div class="player-header"><div class="player-photo-placeholder">üèåÔ∏è</div><div><div class="player-name-h">${nom}</div><div class="player-name-sub">Chapeau ${chapeau}</div></div></div><div class="player-stats-grid"><div class="pstat"><div class="pstat-val ${cls}">${sc}</div><div class="pstat-lbl">Score Masters</div></div><div class="pstat"><div class="pstat-val">C${chapeau}</div><div class="pstat-lbl">Chapeau</div></div></div></div>`;
    return;
  }
  const photoHtml=info.photo_url?`<img class="player-photo" src="${info.photo_url}" onerror="this.outerHTML='<div class=\\'player-photo-placeholder\\'>üèåÔ∏è</div>'" alt="${nom}">`:`<div class="player-photo-placeholder">üèåÔ∏è</div>`;
  const s=info.statistiques||{};
  const palmares=(info.palmares_liste||[]).slice(0,5).map(p=>`<div class="palmares-item">üèÜ ${p}</div>`).join('');
  modal.innerHTML=`<div class="player-sheet" style="position:relative">
    <button class="player-close" onclick="closePlayerCard()">‚úï</button>
    <div class="player-header">${photoHtml}<div><div class="player-name-h">${nom}</div><div class="player-name-sub">${info.nationalite||''} ¬∑ ${info.age?info.age+' ans':''}</div><div style="font-size:12px;color:var(--gold);margin-top:3px;letter-spacing:1px">Chapeau ${chapeau}</div></div></div>
    <div class="player-stats-grid">
      <div class="pstat"><div class="pstat-val ${cls}">${sc}</div><div class="pstat-lbl">Score Masters</div></div>
      <div class="pstat"><div class="pstat-val">#${info.classement_mondial||'?'}</div><div class="pstat-lbl">Classement</div></div>
      <div class="pstat"><div class="pstat-val">${info.palmares_majeurs||0}</div><div class="pstat-lbl">Majeurs</div></div>
      <div class="pstat"><div class="pstat-val">${info.turned_pro||'?'}</div><div class="pstat-lbl">Pro depuis</div></div>
    </div>
    ${info.meilleur_resultat_masters?`<div style="background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.25);border-radius:2px;padding:10px;margin-bottom:14px;font-size:13px;text-align:center;font-style:italic">‚õ≥ Masters : <strong style="color:var(--gold)">${info.meilleur_resultat_masters}</strong></div>`:''}
    <p class="player-bio">${info.bio||''}</p>
    ${s.driving_distance?`<div class="player-stats-grid" style="margin-bottom:14px"><div class="pstat"><div class="pstat-val" style="font-size:15px">${s.driving_distance}</div><div class="pstat-lbl">Drive</div></div><div class="pstat"><div class="pstat-val" style="font-size:15px">${s.fairways||'?'}</div><div class="pstat-lbl">Fairways</div></div><div class="pstat"><div class="pstat-val" style="font-size:15px">${s.gir||'?'}</div><div class="pstat-lbl">GIR</div></div><div class="pstat"><div class="pstat-val" style="font-size:15px">${s.putts_par_trou||'?'}</div><div class="pstat-lbl">Putts/trou</div></div></div>`:''}
    ${palmares?`<div style="margin-top:4px"><div style="font-family:'Cormorant Garamond',serif;font-size:12px;letter-spacing:2px;text-transform:uppercase;color:var(--gold);margin-bottom:10px">Palmar√®s</div>${palmares}</div>`:''}
  </div>`;
}
function closePlayerCard(){const m=document.getElementById('player-modal');if(m) m.remove();}

// ---- NEWS ----
async function loadNews(){
  newsLoaded=true;
  const el=document.getElementById('tab-news');
  el.innerHTML=`<div style="text-align:center;padding:40px 20px"><div class="typing-dots"><span>‚óè</span><span>‚óè</span><span>‚óè</span></div><p style="color:var(--text-muted);font-size:14px;font-style:italic;margin-top:14px">Recherche des derni√®res actualit√©s golf...</p></div>`;
  const joueursList=ALL_JOUEURS.join(', ');
  const prompt=`Tu es journaliste golf expert. Recherche les derni√®res actualit√©s du golf mondial. Couvre : Masters 2025 (Augusta, favoris), PGA Tour (r√©sultats r√©cents), LIV Golf, Rumeurs/transferts, Stats/performances. Joueurs √† mentionner si possible : ${joueursList}. Retourne UNIQUEMENT JSON sans markdown : {"sections":[{"titre":"Masters 2025","type":"masters","articles":[{"titre":"Titre en fran√ßais","contenu":"3-4 phrases d√©taill√©es","tags":["Masters"]}]}]}. 5 sections, 2 articles chacune.`;
  try{
    const response=await fetch(ESPN_PROXY+'claude',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1000,tools:[{type:'web_search_20250305',name:'web_search'}],messages:[{role:'user',content:prompt}]})});
    const data=await response.json();
    const txt=(data.content||[]).filter(b=>b.type==='text').map(b=>b.text).join('');
    const clean=txt.replace(/```json|```/g,'').trim();
    renderNews(JSON.parse(clean).sections||[]);
  }catch(e){
    renderNews([
      {titre:'Masters 2025',type:'masters',articles:[{titre:'Augusta se pr√©pare pour son tournoi le plus attendu',contenu:"Le Masters Tournament 2025 se d√©roulera du 10 au 13 avril √† Augusta National. Scottie Scheffler arrive en grand favori apr√®s une saison 2024 √©crasante.",tags:['Masters']},{titre:'Les favoris 2025',contenu:"Scheffler, McIlroy, Schauffele et √Öberg sont les grands favoris cette ann√©e.",tags:['Masters','Favoris']}]},
      {titre:'PGA Tour',type:'pga',articles:[{titre:'La saison 2025 bat son plein',contenu:"Plusieurs jeunes talents s'affirment sur le circuit am√©ricain cette saison.",tags:['PGA Tour']},{titre:'Les Fran√ßais brillent',contenu:"Matthieu Pavon continue de repr√©senter fi√®rement le golf fran√ßais sur le PGA Tour.",tags:['PGA Tour','Pavon']}]},
      {titre:'LIV Golf',type:'liv',articles:[{titre:'LIV Golf maintient la pression',contenu:"La ligue continue d'attirer l'attention avec ses formats innovants.",tags:['LIV Golf']},{titre:'L\'avenir du golf mondial',contenu:"Les n√©gociations entre PGA Tour et LIV Golf semblent stagner.",tags:['LIV Golf']}]}
    ]);
  }
}
function renderNews(sections){
  const el=document.getElementById('tab-news');
  if(!sections||!sections.length){el.innerHTML='<div style="text-align:center;padding:40px;color:var(--text-muted);font-style:italic">Aucune actualit√© disponible</div>';return;}
  let html='';
  sections.forEach(s=>{
    html+=`<div class="news-section-title">${s.titre}</div>`;
    (s.articles||[]).forEach(a=>{
      const tags=(a.tags||[]).map(t=>`<span class="news-tag ${s.type||''}">${t}</span>`).join(' ');
      html+=`<div class="news-card">${tags}<h4>${a.titre}</h4><p>${a.contenu}</p></div>`;
    });
  });
  html+=`<div style="text-align:center;margin-top:16px"><button class="btn btn-outline" onclick="newsLoaded=false;loadNews()" style="font-size:13px;letter-spacing:1px">Rafra√Æchir les actualit√©s</button></div>`;
  el.innerHTML=html;
}

// ---- ADMIN ----
function goAdmin(){showScreen('screen-admin');}
function checkAdmin(){
  if(document.getElementById('admin-pwd').value===ADMIN_PWD){
    document.getElementById('admin-auth').style.display='none';
    document.getElementById('admin-panel').style.display='block';
    loadStatutTournoi();loadAdminCodes();
  }else alert('Mot de passe incorrect');
}
async function loadStatutTournoi(){
  try{const cfg=await sbFetch('config?cle=eq.tournoi_ouvert&select=valeur');const val=cfg&&cfg[0]?cfg[0].valeur:'OUI';document.getElementById('statut-tournoi').textContent=`Statut actuel : ${val==='OUI'?'Ouvert aux s√©lections':'S√©lections ferm√©es'}`;}catch(e){}
}
async function setTournoi(val){
  try{await sbFetch('config?cle=eq.tournoi_ouvert',{method:'PATCH',body:JSON.stringify({valeur:val}),prefer:'return=minimal'});loadStatutTournoi();alert('Statut mis √† jour !');}
  catch(e){try{await sbFetch('config',{method:'POST',body:JSON.stringify({cle:'tournoi_ouvert',valeur:val})});loadStatutTournoi();}catch(e2){alert('Erreur');}}
}
async function loadAdminCodes(){
  try{
    const codes=await sbFetch('codes_acces?select=*&order=nom');
    const el=document.getElementById('admin-codes-list');
    if(!codes||!codes.length){el.innerHTML='<p style="font-size:13px;font-style:italic;color:var(--text-muted)">Aucun participant enregistr√©.</p>';return;}
    el.innerHTML=codes.map(c=>`<div class="admin-code-row">
      <div style="flex:1">
        <div style="font-style:italic;font-size:14px">${c.nom}</div>
        ${c.prenom_reel||c.nom_reel?`<div style="font-size:12px;color:var(--text-muted);margin-top:2px">${[c.prenom_reel,c.nom_reel].filter(Boolean).join(' ')}</div>`:''}
      </div>
      <span class="code-badge">${c.code}</span>
      <button onclick="deleteCode('${c.nom.replace(/'/g,"\\'")}','${c.code}')" style="background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:16px">‚úï</button>
    </div>`).join('');
  }catch(e){document.getElementById('admin-codes-list').innerHTML='<p style="font-size:13px;color:#e09090">Erreur de chargement</p>';}
}
async function addParticipantCode(){
  const prenom=document.getElementById('new-prenom').value.trim();
  const nom=document.getElementById('new-nom').value.trim();
  const pseudo=document.getElementById('new-participant-nom').value.trim();
  const code=document.getElementById('new-participant-code').value.trim();
  if(!pseudo||!code){showMsg('admin-codes-msg','Pseudo et code requis','error');return;}
  try{
    await sbFetch('codes_acces',{method:'POST',body:JSON.stringify({nom:pseudo,code,prenom_reel:prenom||null,nom_reel:nom||null}),prefer:'return=minimal'});
    document.getElementById('new-prenom').value='';
    document.getElementById('new-nom').value='';
    document.getElementById('new-participant-nom').value='';
    document.getElementById('new-participant-code').value='';
    showMsg('admin-codes-msg',`‚úì ${pseudo} ajout√©`,'success');
    loadAdminCodes();
  }catch(e){showMsg('admin-codes-msg','Erreur ‚Äî ce pseudo existe peut-√™tre d√©j√†','error');console.error(e);}
}
async function deleteCode(nom){
  if(!confirm(`Supprimer ${nom} ?`)) return;
  try{
    await sbFetch(`codes_acces?nom=eq.${encodeURIComponent(nom)}`,{method:'DELETE',prefer:'return=minimal'});
    loadAdminCodes();
  }catch(e){alert('Erreur lors de la suppression');}
}
async function syncESPN(){
  showMsg('sync-msg','Synchronisation...','info');
  const ok=await fetchESPNScores();
  showMsg('sync-msg',ok?`‚úì ${Object.keys(espnScores).length} joueurs synchronis√©s`:'Erreur de synchronisation',ok?'success':'error');
}

document.addEventListener('DOMContentLoaded',()=>{showScreen('screen-accueil');});
</script>
</body>
</html>
